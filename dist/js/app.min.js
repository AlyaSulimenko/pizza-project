(()=>{"use strict";new class{constructor(e){this.type=e}init(){this.оbjects=[],this.daClassname="_dynamic_adapt_",this.nodes=[...document.querySelectorAll("[data-da]")],this.nodes.forEach((e=>{const t=e.dataset.da.trim().split(","),s={};s.element=e,s.parent=e.parentNode,s.destination=document.querySelector(`${t[0].trim()}`),s.breakpoint=t[1]?t[1].trim():"767",s.place=t[2]?t[2].trim():"last",s.index=this.indexInParent(s.parent,s.element),this.оbjects.push(s)})),this.arraySort(this.оbjects),this.mediaQueries=this.оbjects.map((({breakpoint:e})=>`(${this.type}-width: ${e}px),${e}`)).filter(((e,t,s)=>s.indexOf(e)===t)),this.mediaQueries.forEach((e=>{const t=e.split(","),s=window.matchMedia(t[0]),i=t[1],a=this.оbjects.filter((({breakpoint:e})=>e===i));s.addEventListener("change",(()=>{this.mediaHandler(s,a)})),this.mediaHandler(s,a)}))}mediaHandler(e,t){e.matches?t.forEach((e=>{this.moveTo(e.place,e.element,e.destination)})):t.forEach((({parent:e,element:t,index:s})=>{t.classList.contains(this.daClassname)&&this.moveBack(e,t,s)}))}moveTo(e,t,s){t.classList.add(this.daClassname),"last"===e||e>=s.children.length?s.append(t):"first"!==e?s.children[e].before(t):s.prepend(t)}moveBack(e,t,s){t.classList.remove(this.daClassname),void 0!==e.children[s]?e.children[s].before(t):e.append(t)}indexInParent(e,t){return[...e.children].indexOf(t)}arraySort(e){"min"===this.type?e.sort(((e,t)=>e.breakpoint===t.breakpoint?e.place===t.place?0:"first"===e.place||"last"===t.place?-1:"last"===e.place||"first"===t.place?1:0:e.breakpoint-t.breakpoint)):e.sort(((e,t)=>e.breakpoint===t.breakpoint?e.place===t.place?0:"first"===e.place||"last"===t.place?1:"last"===e.place||"first"===t.place?-1:0:t.breakpoint-e.breakpoint))}}("max").init(),function(e){let t=new Image;t.onload=t.onerror=function(){!function(e){let t=!0===e?"webp":"no-webp";document.documentElement.classList.add(t)}(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}();const e=document.querySelector(".sidebar__items"),t=document.querySelector(".card"),s=document.querySelectorAll(".type__link"),i=document.getElementById("rests-sorting"),a=document.querySelectorAll(".tooltip-trigger"),n=document.getElementById("quantity"),o=document.querySelector(".edit"),r=document.getElementById("edit-form"),l=document.getElementById("name-input"),d=document.getElementById("pictureUrl-input"),c=document.getElementById("lat-input"),u=document.getElementById("lng-input"),m=document.getElementById("address-input"),p=document.getElementById("phone-input"),h=document.getElementById("url-input"),v=Array.from(r.querySelectorAll("input[type=radio]")),g=Array.from(document.form.type),y=Array.from(r.querySelectorAll("input[type=checkbox]")),b=Array.from(document.form.details),f=document.querySelector(".button_delete-all"),_=document.querySelector(".button_save"),E=document.querySelector(".button_save-changes"),S=document.querySelector(".round-btn_add"),k=document.querySelector(".round-btn_back"),w=document.getElementById("map");class A{id=(Date.now()+"").slice(-10);constructor(e,t,s,i,a,n,o,r,l,d,c){this.name=e,this.pictureUrl=t,this.lat=s,this.lng=i,this.address=a,this.phone=n,this.webUrl=o,this.type=r,this.details=l,this.distance=d,this.zoomLevel=c}}new class{map;mapZoomLevel=13;rests=[];restsFiltered;restsSorted;mapEvent;isFiltered=!1;isSorted=!1;currentPosition=null;constructor(){this.getPosition(),this.getLocalStorage(),S.addEventListener("click",this.showEmptyForm.bind(this)),k.addEventListener("click",this.hideEmptyForm.bind(this)),_.addEventListener("click",this.newRest.bind(this)),E.addEventListener("click",this.updateRest.bind(this)),w.addEventListener("click",this.openRestCard.bind(this)),e.addEventListener("click",this.moveToPopUp.bind(this)),f.addEventListener("click",this.deleteAllRests.bind(this)),s.forEach((e=>{e.addEventListener("click",this.renderFilteredByTypeRests.bind(this))})),i.addEventListener("change",this.sortBySelect.bind(this)),a.forEach((e=>{e.addEventListener("mouseover",(()=>{e.previousElementSibling.classList.add("show")}))})),a.forEach((e=>{e.addEventListener("mouseleave",(()=>{e.previousElementSibling.classList.remove("show")}))}))}deleteAllRests(){this.rests=[],this.setLocalStorage(),location.reload()}deleteRest(e){if(e.preventDefault(),e.target.classList.contains("erase-icon")||e.target.classList.contains("item-sidebar__delete")){const t=e.target.closest(".item-sidebar"),s=this.rests.findIndex((e=>e.id===t.dataset.id));confirm("Are you sure you want to delete this item?")&&(this.rests.splice(s,1),this.setLocalStorage(),location.reload())}}findMatchingObject(e){if(e)return this.rests.find((t=>t.id===e.dataset.id))}findMatchingPopup(e){const t=Array.from(document.querySelectorAll(".rest-popup"));if(!e)return;const s=t.find((t=>t.dataset.id===e.dataset.id));return t.forEach((e=>e.classList.remove("zoomed-in"))),s}findOutFeatures(e){const t=b.filter((e=>e.checked));0===t.length||t.length>4?document.getElementById("features-error").style.display="block":document.getElementById("features-error").style.display="none";const s=t.map((e=>e.id));return console.log(s),s}findOutType(){let e;for(let t=0;t<g.length;t++)g[t].checked&&(e=g[t].value);return e}getDistance(e,t){const[s,i]=t,a=L.latLng(s,i),n=L.latLng(e.lat,e.lng),o=(a.distanceTo(n)/1e3).toFixed(2);return console.log(`From me to ${e.name} ${o}`),o}getLocalStorage(){const e=JSON.parse(localStorage.getItem("restaraunts"));e&&(this.rests=e)}getPosition(){navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{this.loadMap(e)}),(()=>{alert("Your position is unavailable")})):alert("Geolocation is not supported by your browser")}hideEmptyForm(){l.value=d.value=c.value=u.value=m.value=p.value=h.value="",y.forEach((e=>e.checked=!1)),v.forEach((e=>e.checked=!1)),document.querySelector(".edit").classList.remove("show")}loadMap(e){const t=[50.009916823036455,36.217710562611956];this.map=L.map(w).setView(t,this.mapZoomLevel),L.tileLayer("https://tile.thunderforest.com/mobile-atlas/{z}/{x}/{y}.png?apikey=7d1fdef00f54433b927c5529f4459dde",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.map);const s=L.latLngBounds();L.marker(t).addTo(this.map).bindPopup(L.popup({maxWidth:50,minWidth:50,autoClose:!1,closeOnClick:!1,className:"location-popup"})).setPopupContent('<div class="location-popup"><img src="../img/hungry.svg" alt="hungry" /></div>').openPopup(),s.extend(t),this.rests.forEach((e=>{const i=[e.lat,e.lng];L.marker(i).addTo(this.map).bindPopup(L.popup({maxWidth:50,minWidth:50,autoClose:!1,closeOnClick:!1,className:e.type})).setPopupContent(`<div class="rest-popup with-id ${e.type}" data-id='${e.id}'><img src="../img/pizza-love.svg" alt="pizza" /></div>`).openPopup(),s.extend(i),e.distance=this.getDistance(e,t),this.renderToSidebar(e)})),this.map.fitBounds(s),n.innerHTML=this.rests.length}moveToPopUp(e){const t=e.target.closest(".item-sidebar"),s=this.findMatchingObject(t);this.map.setView([s.lat,s.lng],this.mapZoomLevel,{animate:!0,pan:{duration:1.5}}),this.findMatchingPopup(t).classList.add("in-focus")}newRest(e){if(r.checkValidity()){const e=l.value,t=d.value,s=c.value,i=u.value,a=m.value,n=p.value,o=h.value,r=this.findOutType(),v=this.findOutFeatures();console.log(v);const g=new A(e,t,s,i,a,n,o,r,v);this.rests.push(g),this.renderToSidebar(g),this.renderRestMarker(g),this.setLocalStorage(),location.reload()}else alert("Please fill out all required fields.")}openRestCard(e){o.classList.contains("show")&&o.classList.remove("show");const s=e.target.closest(".with-id");if(s.classList.contains("zoomed-in"))s.classList.contains("zoomed-in")&&(s.classList.remove("zoomed-in"),t.classList.remove("show"));else{s.classList.remove("in-focus"),s.classList.contains("location-popup")?s.classList.toggle("show"):(s.classList.contains("fancy")||s.classList.contains("casual")||s.classList.contains("takeaway")||s.classList.contains("item-sidebar"))&&t.classList.add("show");const e=this.findMatchingObject(s);this.map.setView([e.lat,e.lng],this.mapZoomLevel,{animate:!0,pan:{duration:1.5}}),document.querySelectorAll(".rest-popup").forEach((e=>e.classList.remove("zoomed-in"))),s.classList.add("zoomed-in");const i=`<div class="card__header sidebar__header">\n    <div class="card__logo logo">\n      <div class="logo__image">\n        <img src="../img/logo.png" alt="logo" />\n      </div>\n      <h1 class="logo__title title">Pizza Hunt</h1>\n    </div>\n  </div>\n  <div class="card__body">\n    <h2 class="card__title title" id="card-title">\n      ${e.name}\n    </h2>\n    <div class="card__columns">\n      <div class="card__column_tab">\n        <div class="card__image" id="card-img-url">\n          <img\n            src="${e.pictureUrl}"\n            alt="restaurant"\n          />\n        </div>\n      </div>\n      <div class="card__column_tab card__column_tab-with-footer">\n        <ul class="card__contacts">\n          <li class="card__address">\n            <span class="material-symbols-outlined">\n              location_on </span\n            ><span>${e.address}</span>\n          </li>\n          <li class="card__phone">\n            <a href="tel:${e.phone}"\n              ><span class="material-symbols-outlined"> call </span\n              ><span>${e.phone}</span></a\n            >\n          </li>\n          <li class="card__web">\n            <a href="${e.webUrl}" target="_blank"\n              ><span class="material-symbols-outlined">\n                language </span\n              ><span>Check the web-site!</span></a\n            >\n          </li>\n        </ul>\n        <ul class="card__tags">\n        </ul>\n      </div>\n      <div class="card__column_tab"></div>\n    </div>\n  </div>\n  <div\n    class="card__footer sidebar__footer"\n    data-da=".card__column_tab-with-footer, 991.98"\n  >\n    <button class="button button_edit-info">Edit Info</button\n    >\n    <button class="round-btn round-btn_back card-btn_back">\n      <span></span><span></span><span></span>\n    </button>\n  </div>`;t.innerHTML=i,t.setAttribute("data-id",`${e.id}`),t.classList.add("with-id"),e.details&&e.details.forEach((e=>{let t=y.find((t=>t.id===e));if(t){const s=t.value;console.log(s);const i=document.createElement("li");i.classList.add("card__tag");const a=`<p class="tooltip-text">${s}</p>\n            <a href="" class="card__link tooltip-trigger ${e}">\n              <img src="../img/details(naming!)/${e}.svg" alt="${e}"/>\n            </a>`;i.innerHTML=a,document.querySelector(".card__tags").appendChild(i)}}));const a=t.querySelectorAll(".tooltip-trigger");a.forEach((e=>{e.addEventListener("mouseover",(()=>{e.previousElementSibling.classList.add("show")}))})),a.forEach((e=>{e.addEventListener("mouseleave",(()=>{e.previousElementSibling.classList.remove("show")}))}))}t.querySelector(".card-btn_back").addEventListener("click",(()=>{s.classList.remove("zoomed-in"),t.classList.remove("show")})),t.querySelector(".button_edit-info").addEventListener("click",this.showEditingForm.bind(this))}renderFilteredByTypeRests(t){t.preventDefault();const i=t.target.parentNode,a=JSON.parse(localStorage.getItem("restaraunts")),o=Array.from(document.querySelectorAll(".rest-popup")).map((e=>{const t=e.closest(".leaflet-popup");return t.classList.add(`${e.classList.item(2)}`),t||null}));if(i.classList.contains("active"))i.classList.contains("active")&&(this.isFiltered=!1,s.forEach((e=>e.classList.remove("inactive"))),s.forEach((e=>e.classList.remove("active"))),e.innerHTML="",this.getLocalStorage(),o.forEach((e=>e.style.display="block")));else{if(this.isFiltered=!0,s.forEach((e=>e.classList.remove("active"))),s.forEach((e=>e.classList.add("inactive"))),i.classList.remove("inactive"),i.classList.add("active"),!a)return;this.restsFiltered=[...a],this.restsFiltered=this.restsFiltered.filter((e=>i.classList.contains(`${e.type}`))),localStorage.setItem("filtered restaraunts",JSON.stringify(this.restsFiltered));const t=JSON.parse(localStorage.getItem("filtered restaraunts"));if(!t)return;this.restsFiltered=t,e.innerHTML="",this.restsFiltered.forEach((e=>{this.renderToSidebar(e)})),o.forEach((e=>e.style.display="none")),o.filter((e=>i.classList.contains(e.classList.item(1)))).forEach((e=>e.style.display="block"))}this.sortBySelect(),n.innerHTML=this.isFiltered?this.restsFiltered.length:this.rests.length}renderRestMarker(e){L.marker([+e.lat,+e.lng]).addTo(this.map).bindPopup(L.popup({maxWidth:50,minWidth:50,autoClose:!1,closeOnClick:!1,className:`${e.type}`})).setPopupContent(`<div class="rest-popup  with-id ${e.type}" data-id='${e.id}'><img src="../img/pizza-love.svg" alt="pizza"\n      /></div>`).openPopup()}renderToSidebar(t){let s=document.createElement("li");s.setAttribute("data-id",`${t.id}`),s.classList.add("item-sidebar"),s.classList.add("with-id"),s.classList.add(`item-sidebar_${t.type}`),s.innerHTML=`<div class="item-sidebar__header">\n    <div class="item-sidebar__title">${t.name}</div>\n    <div class="item-sidebar__actions">\n      <a href="#" class="item-sidebar__more">\n        <span class="material-symbols-outlined more-icon">more</span>\n      </a>\n      <a href="#" class="item-sidebar__edit">\n        <span class="material-symbols-outlined edit-icon">edit</span>\n      </a>\n      <a href="#" class="item-sidebar__delete">\n        <span class="material-symbols-outlined erase-icon">close</span>\n      </a>\n    </div>\n  </div>\n  <div class="item-sidebar__footer">\n    <div class="item-sidebar__distance">${t.distance} km away</div>\n  </div>`,e.appendChild(s),this.hideEmptyForm(),s.querySelector(".more-icon").addEventListener("click",(e=>this.openRestCard(e))),s.querySelector(".edit-icon").addEventListener("click",(e=>this.showEditingForm(e))),s.querySelector(".erase-icon").addEventListener("click",(e=>this.deleteRest(e)))}setLocalStorage(){localStorage.setItem("restaraunts",JSON.stringify(this.rests))}showEditingForm(e){o.classList.add("show"),E.style.display="inline-block",_.style.display="none";const t=e.target.closest(".with-id");t.classList.add("under-edition");const s=this.findMatchingObject(t);l.value=s.name,d.value=s.pictureUrl,c.value=s.lat,u.value=s.lng,m.value=s.address,p.value=s.phone,h.value=s.webUrl,v.forEach((e=>{e.value===s.type&&(e.checked=!0)})),y.forEach((e=>{s.details.includes(e.value)&&(e.checked=!0)}))}showEmptyForm(){o.classList.add("show"),E.style.display="none",_.style.display="inline-block"}sortBySelect(){const t=i.value;let s,a;switch(this.isFiltered?(s=this.restsFiltered,a="filtered restaraunts"):this.isFiltered||(s=this.rests,a="restaraunts"),t){case"a-z":this.restsSorted=s.sort(((e,t)=>e.name.localeCompare(t.name)));break;case"z-a":this.restsSorted=s.sort(((e,t)=>e.name.localeCompare(t.name))).reverse();break;case"nearest":this.restsSorted=s.sort(((e,t)=>{const s=e.distance,i=t.distance;return console.log(s,i),s-i}));break;case"furthest":this.restsSorted=s.sort(((e,t)=>{const s=e.distance;return t.distance-s}));break;default:this.restsSorted=this.rests}localStorage.setItem(a,JSON.stringify(s)),e.innerHTML="";const n=JSON.parse(localStorage.getItem(a));n&&(s=n,s.forEach((e=>{this.renderToSidebar(e)})))}updateRest(){if(r.checkValidity()){const e=document.querySelector(".under-edition"),t=this.findMatchingObject(e);t.name=l.value,t.pictureUrl=d.value,t.lat=c.value,t.lng=u.value,t.address=m.value,t.phone=p.value,t.webUrl=h.value,t.type=this.findOutType(),t.details=this.findOutFeatures(),e.classList.remove("under-edition"),this.setLocalStorage(),location.reload()}else alert("Please fill out all required fields.")}}})();